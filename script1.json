{"paragraphs":[{"text":"%pyspark\nspark","user":"anonymous","dateUpdated":"2018-11-27T23:53:27+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<pyspark.sql.session.SparkSession object at 0x7fe583438ef0>\n"}]},"apps":[],"jobName":"paragraph_1543362807755_1354938685","id":"20181121-103540_732683715","dateCreated":"2018-11-27T23:53:27+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:17843"},{"text":"%pyspark\nfrom pyspark.sql import SQLContext\nmeses = [\"12\", \"11\", \"10\", \"09\", \"08\",\"07\",\"06\",\"05\",\"04\",\"03\",\"02\",\"01\"]\nanos = [\"2017\", \"2016\",\"2015\"]\n\ncols = ['total_taxi','total_app','mes','ano', 'mes_passado', 'ano_passado', 'taxa_taxi_mes_passado', 'taxa_app_mes_passado', 'mudanca_mes_taxi','mudanca_mes_app', 'total_taxi_ano_passado','total_app_ano_passado','taxa_taxi_ano_passado','taxa_app_ano_passado', 'mudanca_ano_taxi','mudanca_ano_app']\nvals = []\n\nfor ano in anos:\n    for mes in meses:\n        \n        taxi = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano + '-' + mes+ '.csv', header = True)\n        app = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano + '-' + mes+ '.csv', header = True)\n            \n        total_taxi = taxi.count()\n        total_app = app.count()\n            \n        if mes == \"01\":\n            mes_passado = \"12\"\n            if ano != \"2015\":\n                ano2 = str(int(ano) - 1)\n            else:\n                ano2 = \"2015\"\n            taxi_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano2 + '-' + mes_passado + '.csv', header = True)\n            app_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano2 + '-' + mes_passado + '.csv', header = True)\n        elif mes == \"11\" or mes==\"12\":\n            mes_passado = str(int(mes) - 1)\n        else:\n            mes_passado = \"0\" + str(int(mes) - 1)\n            \n        if ano == \"2015\":\n            ano_passado = \"2015\"\n        else:\n            ano_passado = str(int(ano) - 1)\n            \n        taxi_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano+ '-' + mes_passado + '.csv', header = True)\n        app_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano + '-' + mes_passado + '.csv', header = True)\n            \n        total_taxi_mes_passado = taxi_mes_passado.count()\n        total_app_mes_passado = app_mes_passado.count()\n        \n        taxa_taxi_mes_passado = ((total_taxi / total_taxi_mes_passado) - 1) * 100\n        taxa_app_mes_passado = ((total_app / total_app_mes_passado) - 1) * 100\n            \n        if taxa_taxi_mes_passado < 1:\n            mudanca_mes_taxi = \"uma diminuição\"\n            taxa_taxi_mes_passado *= -1\n        else:\n            mudanca_mes_taxi = \"um aumento\"\n        \n        if taxa_app_mes_passado < 1:\n            mudanca_mes_app = \"uma diminuição\"\n            taxa_app_mes_passado *= -1\n        else:\n            mudanca_mes_app = \"um aumento\"\n            \n        taxi_ano_passado = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano_passado + '-' + mes + '.csv', header = True)\n        app_ano_passado = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano_passado + '-' + mes + '.csv', header = True)\n            \n        total_taxi_ano_passado = taxi_ano_passado.count()\n        total_app_ano_passado = app_ano_passado.count()\n            \n        taxa_taxi_ano_passado = ((total_taxi / total_taxi_ano_passado) - 1) * 100\n        taxa_app_ano_passado = ((total_app / total_app_ano_passado) - 1) * 100\n    \n        if taxa_taxi_ano_passado < 1:\n            mudanca_ano_taxi = \"uma diminuição\"\n            taxa_taxi_ano_passado *= -1\n        else:\n            mudanca_ano_taxi = \"um aumento\"\n        \n        if taxa_app_ano_passado < 1:\n            mudanca_ano_app = \"uma diminuição\"\n            taxa_app_ano_passado *= -1\n        else:\n            mudanca_ano_app = \"um aumento\"\n        \n        \n        temp = [total_taxi,total_app,mes,ano, mes_passado, ano_passado, taxa_taxi_mes_passado, taxa_app_mes_passado, mudanca_mes_taxi,mudanca_mes_app, total_taxi_ano_passado,total_app_ano_passado,taxa_taxi_ano_passado,taxa_app_ano_passado, mudanca_ano_taxi,mudanca_ano_app]\n        vals.append(temp)\n        print(temp)\n        \n# PARA 2018: MENOS MESES\nm = [\"01\", \"02\", \"03\", \"04\", \"05\", \"06\"]\nfor mes in m:\n\n    ano = \"2018\"\n        \n    taxi = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano + '-' + mes + '.csv', header = True)\n    app = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano + '-' + mes + '.csv', header = True)\n            \n    total_taxi = taxi.count()\n    total_app = app.count()\n            \n    if mes == \"01\":\n        mes_passado = \"12\"\n        ano2 = str(int(ano) - 1)\n        taxi_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano2 + '-' + mes_passado + '.csv', header = True)\n        app_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano2 + '-' + mes_passado + '.csv', header = True)\n    else:    \n        mes_passado = \"0\" + str(int(mes) - 1)\n            \n    ano_passado = str(int(ano) - 1)\n            \n    taxi_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano + '-' + mes_passado + '.csv', header = True)\n    app_mes_passado = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano + '-' + mes_passado + '.csv', header = True)\n            \n    total_taxi_mes_passado = taxi_mes_passado.count()\n    total_app_mes_passado = app_mes_passado.count()        \n    \n    taxa_taxi_mes_passado = ((total_taxi / total_taxi_mes_passado) - 1) * 100\n    taxa_app_mes_passado = ((total_app / total_app_mes_passado) - 1) * 100\n            \n    if taxa_taxi_mes_passado < 1:\n        mudanca_mes_taxi = \"uma diminuição\"\n        taxa_taxi_mes_passado *= -1\n    else:\n        mudanca_mes_taxi = \"um aumento\"\n        \n    if taxa_app_mes_passado < 1:\n        mudanca_mes_app = \"uma diminuição\"\n        taxa_app_mes_passado *= -1\n    else:\n        mudanca_mes_app = \"um aumento\"\n            \n    taxi_ano_passado = spark.read.csv(r's3://nyc-tlc/trip data/yellow_tripdata_' + ano_passado + '-' + mes + '.csv', header = True)\n    app_ano_passado = spark.read.csv(r's3://nyc-tlc/trip data/fhv_tripdata_' + ano_passado + '-' + mes + '.csv', header = True)\n            \n    total_taxi_ano_passado = taxi_ano_passado.count()\n    total_app_ano_passado = app_ano_passado.count()\n            \n    taxa_taxi_ano_passado = ((total_taxi / total_taxi_ano_passado) - 1) * 100\n    taxa_app_ano_passado = ((total_app / total_app_ano_passado) - 1) * 100\n    \n    if taxa_taxi_ano_passado < 1:\n        mudanca_ano_taxi = \"uma diminuição\"\n        taxa_taxi_ano_passado *= -1\n    else:\n        mudanca_ano_taxi = \"um aumento\"\n        \n    if taxa_app_ano_passado < 1:\n        mudanca_ano_app = \"uma diminuição\"\n        taxa_app_ano_passado *= -1\n    else:\n        mudanca_ano_app = \"um aumento\"\n        \n    temp = [total_taxi,total_app,mes,ano, mes_passado, ano_passado, taxa_taxi_mes_passado, taxa_app_mes_passado, mudanca_mes_taxi,mudanca_mes_app, total_taxi_ano_passado,total_app_ano_passado,taxa_taxi_ano_passado,taxa_app_ano_passado, mudanca_ano_taxi,mudanca_ano_app]\n    vals.append(temp)\n    print(temp)\n    \ndf = sqlContext.createDataFrame(vals, cols)","user":"anonymous","dateUpdated":"2018-11-27T23:53:27+0000","config":{"lineNumbers":true,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1543362807756_1635279290","id":"20181126-111430_634266897","dateCreated":"2018-11-27T23:53:27+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:17844"},{"text":"%pyspark\n\ndf.repartition(1).write.csv('/tmp/dados.csv', header=\"true\")","user":"anonymous","dateUpdated":"2018-11-27T23:58:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1543363088840_543946208","id":"20181127-235808_370112463","dateCreated":"2018-11-27T23:58:08+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:17845"}],"name":"script1","id":"2DYGQ3726","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}